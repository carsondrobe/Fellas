{% load static %}
<nav class="navbar navbar-expand-lg navbar-dark foreground">
    <a class="navbar-brand foreground"
        href="{% if user_type == 'CU' %}{% url 'weather' %}{% else %}{% url 'fire' %}{% endif %}">BC Weather and
        Wildfire</a>
    <div id="date_selector" class="ml-auto">
        <strong><span id="selected_date" class="text-white p-2">Today</span></strong>
        <img class="datepicker-toggle-button" src="../static/images/calendar_icon.svg" alt="calendar icon" width="30">
        <input type="date" class="datepicker-input">
    </div>
    <script> // should be moved to a separate file when we make one
        const date_input = document.querySelector('.datepicker-input');
        const selected_date = document.querySelector('#selected_date');
        date_input.addEventListener('change', function (e) {
            const date = new Date(e.target.value);
            const adjusted_date = new Date(date.getTime() + date.getTimezoneOffset() * 60 * 1000);
            if (adjusted_date.toDateString() === new Date().toDateString()) {
                selected_date.textContent = "Today";
            } else {
                selected_date.textContent = adjusted_date.toLocaleDateString('en-CA');
            }
        });
    </script>

    <div class="nav-item dropdown">
        <a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img class="avatar avatar-32 bg-light rounded-circle text-white p-1"
                src="https://raw.githubusercontent.com/twbs/icons/main/icons/person.svg" width="35px">
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            {% if request.user.is_authenticated %}
            <div id="profile_dropdown_logged_in">
                <a class="dropdown-item" href="#">Alerts</a>
                {% if request.user.is_staff %}
                <a class="dropdown-item" href="{% url 'admin:index' %}">Admin</a>
                <a class="dropdown-item" href="{% url 'view_feedback'}" data-toggle="modal"
                    data-target="#viewFeedbackModal" id="viewFeedbackButton">View Feedback</a>
                {% else %}
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#feedbackModal">Submit Feedback</a>
                {% endif %}

                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                <!-- If user is not logged in, hide the link -->
                {% else %}
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#loginModal">Log in</a>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#registerModal">Register</a>
                {% endif %}
            </div>
        </div>
</nav>

<!-- The Feedback popup Modal -->
<div class="modal" id="feedbackModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content foreground">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Submit Feedback</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <form method="post" action="{% url 'submit_feedback' %}" autocomplete="off"
                    onsubmit="return validateFeedbackForm()">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="exampleFormControlTextarea1">Feedback:</label>
                        <textarea name="feedback" class="form-control" id="exampleFormControlTextarea1"
                            rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>